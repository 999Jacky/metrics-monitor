events {}

http {
  server {
    listen 3001;
    server_name _;

    auth_basic "Restricted";
    auth_basic_user_file /etc/nginx/.htpasswd;

    # 舊格式：/metrics/... 轉向 VictoriaMetrics
    location ~ ^/metrics/(.*)$ {
      proxy_pass http://victoriametrics:8428/api/v1/import/prometheus/metrics/$1;
      proxy_set_header Host $host;
    }

    # 新格式：直接 passthrough 給 VictoriaMetrics
    location /api/v1/import/prometheus/metrics/ {
      proxy_pass http://victoriametrics:8428;
      proxy_set_header Host $host;
    }
  }
}

